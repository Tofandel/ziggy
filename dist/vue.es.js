import{parse as t,stringify as r}from"qs";function e(){return e=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},e.apply(this,arguments)}class n{constructor(t,r,e){var n,s;this.name=t,this.definition=r,this.bindings=null!=(n=r.bindings)?n:{},this.wheres=null!=(s=r.wheres)?s:{},this.config=e}get template(){return`${this.config.absolute?this.definition.domain?`${this.config.url.match(/^\w+:\/\//)[0]}${this.definition.domain}${this.config.port?`:${this.config.port}`:""}`:this.config.url:""}/${this.definition.uri}`.replace(/\/+$/,"")}get parameterSegments(){var t,r;return null!=(t=null==(r=this.template.match(/{[^}?]+\??}/g))?void 0:r.map(t=>({name:t.replace(/{|\??}/g,""),required:!/\?}$/.test(t)})))?t:[]}matchesUrl(r){if(!this.definition.methods.includes("GET"))return!1;const e=this.template.replace(/(\/?){([^}?]*)(\??)}/g,(t,r,e,n)=>{var s;const i=`(?<${e}>${(null==(s=this.wheres[e])?void 0:s.replace(/(^\^)|(\$$)/g,""))||"[^/?]+"})`;return n?`(${r}${i})?`:`${r}${i}`}).replace(/^\w+:\/\//,""),[n,s]=r.replace(/^\w+:\/\//,"").split("?"),i=new RegExp(`^${e}/?$`).exec(n);if(i){const r={};return Object.keys(i.groups).forEach(t=>r[t]=decodeURIComponent(i.groups[t])),{params:r,query:t(s)}}return!1}compile(t){const r=this.parameterSegments;return r.length?this.template.replace(/{([^}?]+)(\??)}/g,(e,n,s)=>{var i,o,u;if(!s&&[null,void 0].includes(t[n]))throw new Error(`Ziggy error: '${n}' parameter is required for route '${this.name}'.`);if(r[r.length-1].name===n&&".*"===this.wheres[n])return encodeURIComponent(null!=(u=t[n])?u:"").replace(/%2F/g,"/");if(this.wheres[n]&&!new RegExp(`^${s?`(${this.wheres[n]})?`:this.wheres[n]}$`).test(null!=(i=t[n])?i:""))throw new Error(`Ziggy error: '${n}' parameter does not match required format '${this.wheres[n]}' for route '${this.name}'.`);return encodeURIComponent(null!=(o=t[n])?o:"")}).replace(/\/+$/,""):this.template}}const s=["_query"];class i extends String{constructor(t,r,n=!0,s){var i;super(),this.t=null!=s?s:(null!=(i=null!=globalThis?globalThis:window)?i:global).Ziggy,this.t=e({},this.t,{absolute:n}),t&&(this.i=t,this.o=r)}toString(){return this.resolve({name:this.i,params:this.o})}resolve({name:t,params:i,query:o}){if(!t)return window.location.toString();if(!this.t.routes[t])throw new Error(`Ziggy error: route '${t}' is not in the route list.`);const u=new n(t,this.t.routes[t],this.t),h=u.parameterSegments,a=this.u(i,u),{_query:l}=a,c=function(t,r){if(null==t)return{};var e,n,s={},i=Object.keys(t);for(n=0;n<i.length;n++)r.indexOf(e=i[n])>=0||(s[e]=t[e]);return s}(a,s),m=Object.keys(c).filter(t=>!h.some(({name:r})=>r===t)).reduce((t,r)=>e({},t,{[r]:c[r]}),{});return u.compile(c)+r(e({},m,l,o),{addQueryPrefix:!0,arrayFormat:"indices",encodeValuesOnly:!0,skipNulls:!0,encoder:(t,r)=>"boolean"==typeof t?Number(t):r(t)})}unresolve(t){t?this.t.absolute&&t.startsWith("/")&&(t=this.h().host+t):t=this.l();let r={};const[s,i]=Object.entries(this.t.routes).find(([e,s])=>r=new n(e,s,this.t).matchesUrl(t))||[void 0,void 0];return e({name:s},r,{route:i})}l(){const{host:t,pathname:r,search:e}=this.h();return(this.t.absolute?t+r:r.replace(this.t.url.replace(/^\w*:\/\/[^/]+/,""),"").replace(/^\/+/,"/"))+e}current(t,r){const{name:s,params:i,query:o,route:u}=this.unresolve();if(!t)return s;const h=new RegExp(`^${t.replace(/\./g,"\\.").replace(/\*/g,".*")}$`).test(s);if([null,void 0].includes(r)||!h)return h;const a=new n(s,u,this.t);r=this.u(r,a);const l=e({},i,o);return!(!Object.values(r).every(t=>!t)||Object.values(l).some(t=>void 0!==t))||Object.entries(r).every(([t,r])=>l[t]==r)}h(){var t,r,e,n,s,i;const{host:o="",pathname:u="",search:h=""}="undefined"!=typeof window?window.location:{};return{host:null!=(t=null==(r=this.t.location)?void 0:r.host)?t:o,pathname:null!=(e=null==(n=this.t.location)?void 0:n.pathname)?e:u,search:null!=(s=null==(i=this.t.location)?void 0:i.search)?s:h}}get params(){const{params:t,query:r}=this.unresolve();return e({},t,r)}has(t){return Object.keys(this.t.routes).includes(t)}u(t={},r){null!=t||(t={}),t=["string","number"].includes(typeof t)?[t]:t;const n=r.parameterSegments.filter(({name:t})=>!this.t.defaults[t]);return Array.isArray(t)?t=t.reduce((t,r,s)=>e({},t,n[s]?{[n[s].name]:r}:"object"==typeof r?r:{[r]:""}),{}):1!==n.length||t[n[0].name]||!{}.hasOwnProperty.call(t,Object.values(r.bindings)[0])&&!{}.hasOwnProperty.call(t,"id")||(t={[n[0].name]:t}),e({},this.m(r),this.g(t,r))}m(t){return t.parameterSegments.filter(({name:t})=>this.t.defaults[t]).reduce((t,{name:r})=>e({},t,{[r]:this.t.defaults[r]}),{})}g(t,{bindings:r,parameterSegments:n}){return Object.entries(t).reduce((t,[s,i])=>{if(!i||"object"!=typeof i||Array.isArray(i)||!n.some(({name:t})=>t===s))return e({},t,{[s]:i});if(!{}.hasOwnProperty.call(i,r[s])){if(!{}.hasOwnProperty.call(i,"id"))throw new Error(`Ziggy error: object passed as '${s}' parameter is missing route model binding key '${r[s]}'.`);r[s]="id"}return e({},t,{[s]:i[r[s]]})},{})}valueOf(){return this.toString()}check(t){return this.has(t)}}const o={install:(t,r,e="route",n=!0)=>{const s=(t,e,n,s=r)=>function(t,r,e,n){const s=new i(t,r,e,n);return t?s.toString():s}(t,e,n,s);n&&(t.config&&(t.config.globalProperties[e]=s),t.mixin&&t.mixin({methods:{[e]:s}})),t.provide&&t.provide(e,s)}};export{o as ZiggyVue};
