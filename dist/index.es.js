import{parse as t,stringify as r}from"qs";function e(){return e=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},e.apply(this,arguments)}class n{constructor(t,r,e){var n,i;this.name=t,this.definition=r,this.bindings=null!=(n=r.bindings)?n:{},this.wheres=null!=(i=r.wheres)?i:{},this.config=e}get template(){return`${this.config.absolute?this.definition.domain?`${this.config.url.match(/^\w+:\/\//)[0]}${this.definition.domain}${this.config.port?`:${this.config.port}`:""}`:this.config.url:""}/${this.definition.uri}`.replace(/\/+$/,"")}get parameterSegments(){var t,r;return null!=(t=null==(r=this.template.match(/{[^}?]+\??}/g))?void 0:r.map(t=>({name:t.replace(/{|\??}/g,""),required:!/\?}$/.test(t)})))?t:[]}matchesUrl(r){if(!this.definition.methods.includes("GET"))return!1;const e=this.template.replace(/(\/?){([^}?]*)(\??)}/g,(t,r,e,n)=>{var i;const s=`(?<${e}>${(null==(i=this.wheres[e])?void 0:i.replace(/(^\^)|(\$$)/g,""))||"[^/?]+"})`;return n?`(${r}${s})?`:`${r}${s}`}).replace(/^\w+:\/\//,""),[n,i]=r.replace(/^\w+:\/\//,"").split("?"),s=new RegExp(`^${e}/?$`).exec(n);if(s){const r={};return Object.keys(s.groups).forEach(t=>r[t]=decodeURIComponent(s.groups[t])),{params:r,query:t(i)}}return!1}compile(t){const r=this.parameterSegments;return r.length?this.template.replace(/{([^}?]+)(\??)}/g,(e,n,i)=>{var s,o,u;if(!i&&[null,void 0].includes(t[n]))throw new Error(`Ziggy error: '${n}' parameter is required for route '${this.name}'.`);if(r[r.length-1].name===n&&".*"===this.wheres[n])return encodeURIComponent(null!=(u=t[n])?u:"").replace(/%2F/g,"/");if(this.wheres[n]&&!new RegExp(`^${i?`(${this.wheres[n]})?`:this.wheres[n]}$`).test(null!=(s=t[n])?s:""))throw new Error(`Ziggy error: '${n}' parameter does not match required format '${this.wheres[n]}' for route '${this.name}'.`);return encodeURIComponent(null!=(o=t[n])?o:"")}).replace(/\/+$/,""):this.template}}const i=["_query"];class s extends String{constructor(t,r,n=!0,i){var s;super(),this.t=null!=i?i:(null!=(s=null!=globalThis?globalThis:window)?s:global).Ziggy,this.t=e({},this.t,{absolute:n}),t&&(this.i=t,this.o=r)}toString(){return this.resolve({name:this.i,params:this.o})}resolve({name:t,params:s,query:o}){if(!t)return window.location.toString();if(!this.t.routes[t])throw new Error(`Ziggy error: route '${t}' is not in the route list.`);const u=new n(t,this.t.routes[t],this.t),h=u.parameterSegments,a=this.u(s,u),{_query:l}=a,c=function(t,r){if(null==t)return{};var e,n,i={},s=Object.keys(t);for(n=0;n<s.length;n++)r.indexOf(e=s[n])>=0||(i[e]=t[e]);return i}(a,i),m=Object.keys(c).filter(t=>!h.some(({name:r})=>r===t)).reduce((t,r)=>e({},t,{[r]:c[r]}),{});return u.compile(c)+r(e({},m,l,o),{addQueryPrefix:!0,arrayFormat:"indices",encodeValuesOnly:!0,skipNulls:!0,encoder:(t,r)=>"boolean"==typeof t?Number(t):r(t)})}unresolve(t){t?this.t.absolute&&t.startsWith("/")&&(t=this.h().host+t):t=this.l();let r={};const[i,s]=Object.entries(this.t.routes).find(([e,i])=>r=new n(e,i,this.t).matchesUrl(t))||[void 0,void 0];return e({name:i},r,{route:s})}l(){const{host:t,pathname:r,search:e}=this.h();return(this.t.absolute?t+r:r.replace(this.t.url.replace(/^\w*:\/\/[^/]+/,""),"").replace(/^\/+/,"/"))+e}current(t,r){const{name:i,params:s,query:o,route:u}=this.unresolve();if(!t)return i;const h=new RegExp(`^${t.replace(/\./g,"\\.").replace(/\*/g,".*")}$`).test(i);if([null,void 0].includes(r)||!h)return h;const a=new n(i,u,this.t);r=this.u(r,a);const l=e({},s,o);return!(!Object.values(r).every(t=>!t)||Object.values(l).some(t=>void 0!==t))||Object.entries(r).every(([t,r])=>l[t]==r)}h(){var t,r,e,n,i,s;const{host:o="",pathname:u="",search:h=""}="undefined"!=typeof window?window.location:{};return{host:null!=(t=null==(r=this.t.location)?void 0:r.host)?t:o,pathname:null!=(e=null==(n=this.t.location)?void 0:n.pathname)?e:u,search:null!=(i=null==(s=this.t.location)?void 0:s.search)?i:h}}get params(){const{params:t,query:r}=this.unresolve();return e({},t,r)}has(t){return Object.keys(this.t.routes).includes(t)}u(t={},r){null!=t||(t={}),t=["string","number"].includes(typeof t)?[t]:t;const n=r.parameterSegments.filter(({name:t})=>!this.t.defaults[t]);return Array.isArray(t)?t=t.reduce((t,r,i)=>e({},t,n[i]?{[n[i].name]:r}:"object"==typeof r?r:{[r]:""}),{}):1!==n.length||t[n[0].name]||!{}.hasOwnProperty.call(t,Object.values(r.bindings)[0])&&!{}.hasOwnProperty.call(t,"id")||(t={[n[0].name]:t}),e({},this.m(r),this.g(t,r))}m(t){return t.parameterSegments.filter(({name:t})=>this.t.defaults[t]).reduce((t,{name:r})=>e({},t,{[r]:this.t.defaults[r]}),{})}g(t,{bindings:r,parameterSegments:n}){return Object.entries(t).reduce((t,[i,s])=>{if(!s||"object"!=typeof s||Array.isArray(s)||!n.some(({name:t})=>t===i))return e({},t,{[i]:s});if(!{}.hasOwnProperty.call(s,r[i])){if(!{}.hasOwnProperty.call(s,"id"))throw new Error(`Ziggy error: object passed as '${i}' parameter is missing route model binding key '${r[i]}'.`);r[i]="id"}return e({},t,{[i]:s[r[i]]})},{})}valueOf(){return this.toString()}check(t){return this.has(t)}}function o(t,r,e,n){const i=new s(t,r,e,n);return t?i.toString():i}export{o as default};
